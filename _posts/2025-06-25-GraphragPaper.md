---
title: "GraphRAG 和AI一起读论文
layout: post
date: 2025-06-25
categories: tech_coding
tags:
    - graphRAG
---


这篇论文 **《From Local to Global: A Graph RAG Approach to Query-Focused Summarization》** 由微软研究团队提出，主要目标是解决传统 RAG 方法在处理面向整个文档集合的“全局性问题”（如“这个数据集的主要主题是什么？”）时的局限性，提出一种 **Graph RAG**（图结构的 RAG）方法，结合了图谱构建与查询聚焦型摘要（QFS）以提升大语言模型（LLMs）对大规模文本的理解与回答能力。

---

## 一、研究动机与问题背景

传统 RAG 适用于定位问题并从文档中检索出相关片段用于回答，但它更偏向“局部”问题（如事实性问答），而非针对整个语料库的“全局性问题”。而 QFS 虽然能够解决此类问题，但在面对百万级 token 的数据集时无法扩展。

因此，该论文提出：

* **图结构索引（graph-based index）**：利用 LLM 构建实体与关系图；
* **社区总结（community summaries）**：通过社区检测将图划分为结构紧密的子群体；
* **Map-Reduce 式总结（map-reduce summarization）**：先并行生成子答案，再合并得到最终答案。

---

## 二、Graph RAG 方法与流程

该方法由两个阶段构成：**索引阶段（indexing time）** 和 **查询阶段（query time）**。主要步骤如下：

### 1. 文本预处理：文档 → 文本块

将源文档按固定 token 大小（如 600）划分为文本块。

### 2. 实体抽取：文本块 → 图元素实例

通过 LLM 提取每个文本块中的实体（如人、地、组织）、实体间关系和相关“协变量”（如声明、时间等）。

### 3. 摘要生成：元素实例 → 元素摘要

LLM 对实体、关系等进行摘要，生成语义更强、便于后续分析的节点与边描述。

### 4. 图构建与社区划分：元素摘要 → 图社区

构建图结构（实体为节点，关系为边），使用 Leiden 算法进行社区划分，得到多个层次的社区结构。

### 5. 社区摘要生成：社区 → 报告

对每个社区的实体、关系等进行摘要，形成更高层次的结构化语义表达。

### 6. 多阶段问答生成：社区摘要 → 部分答案 → 全局答案

用户提出问题后，系统按社区摘要进行初步问答，然后聚合所有相关子答案生成最终回答。

---

## 三、实验与评估

### 数据集：

* **Podcast Transcripts（约 100 万 token）**
* **新闻文章（MultiHop-RAG，约 170 万 token）**

### 问题设计：

采用“活动驱动”的方式由 LLM 生成共 125 个全局性问题，如：

* 哪些播客涉及技术政策和政府监管？
* 新闻中提到了哪些健康相关的当前话题？

### 对比条件：

六种方法被对比，包括四种 Graph RAG 层级（C0-C3）、全量文本 map-reduce 总结（TS）和 Naive RAG（SS）：

* C0：图根社区摘要
* C1-C3：更细粒度的子社区摘要
* TS：直接对原始文本 map-reduce
* SS：向量检索 + 拼接上下文（传统 RAG）

### 评估维度（用 LLM 进行 head-to-head 比较）：

* **全面性**（Comprehensiveness）：是否覆盖问题所有面向
* **多样性**（Diversity）：是否包含多种观点与角度
* **赋能性**（Empowerment）：是否帮助用户做出判断
* **直接性**（Directness）：回答是否直接明确（作为对照指标）

---

## 四、实验结果与发现

1. **Graph RAG 在全面性和多样性上明显优于 Naive RAG**：

   * Podcast 数据集全面性胜率 72–83%，新闻数据集为 72–80%；
   * 多样性胜率也明显高于基线。

2. **中低层级社区（C2/C3）在性能与效率之间平衡最佳**：

   * 例如 C2 在新闻数据集上以更低 token 成本获得更高准确率。

3. **相比直接处理文本（TS），Graph RAG 更节省 token，表现相当甚至略优**。

4. **C0（根社区摘要）虽性能略低，但效率最高，适合高频问题解答**。

---

## 五、贡献与创新

* 将 LLM 生成的知识图谱用于构建索引；
* 利用图的“模块性”进行社区划分，从而实现并行处理；
* 设计了结合社区结构的 map-reduce 式摘要生成策略；
* 在百万 token 规模上对比六种方法，展示了 Graph RAG 的优越性。

---

## 六、局限与未来方向

* 当前评估数据与问题范围有限；
* Empowerment 维度上 Graph RAG 结果不如预期，需优化实体抽取的保真度；
* 可扩展为支持嵌入匹配、本地检索、drill-down、roll-up 等交互式探索方式；
* 未来将开源实现（[https://aka.ms/graphrag）。](https://aka.ms/graphrag）。)

---

## 七、总结

Graph RAG 是一种面向全局问题、可扩展、高效的 RAG 方案，结合 LLM 能力与图结构组织，对解决文档级 sensemaking 问题具有很大潜力，优于传统 RAG 方法，并具备很强的实用性与通用性。

如果你需要，我还可以为这篇论文制作可视化流程图或进一步将它写成科普文章风格的中文讲解。需要吗？

