---
title: "System Prompt是做什么的? System Prompt如何做到更重要?"
layout: post
date: 2025-02-21
categories: tech_coding
tags:
    - RAG
---

最近一直在学习自然语言处理和大语言模型的一些基本概念, 这些内容是在ChatGPT, Deepseek等大语言模型的帮助下记录的。


在大模型（如ChatGPT、GPT‑4等）的应用中，我们通常会区分两种主要的提示（prompt）：system prompt和user prompt，它们在作用和处理机制上有明显不同：

---

### 1. System Prompt 的作用和使用

- **角色定位和行为约束**  
  System prompt 用于在对话开始时设定模型的整体行为、角色和基本规则。例如，它可以指定“你是一位数学老师”或“你是一名幽默的助理”。这类提示帮助模型形成一个“基线”行为，确保后续的回答都符合预先设定的风格与限制。  

- **持久性和优先级**  
  System prompt 的内容会在整个会话中持续存在，并且通常具有较高的权重。无论用户后续如何提问，模型在生成回答时都会参考这部分提示，从而防止用户输入直接改变模型的“身份”或行为。  

- **安全性与一致性**  
  由于系统提示通常对模型的行为起到约束作用，使用它可以减少模型在回答过程中偏离预期或因用户输入而产生的不安全、不一致的结果。这在防范提示注入等安全风险时尤为重要。  

---

### 2. User Prompt 的作用和使用

- **具体任务指令**  
  User prompt 则代表用户具体提出的问题或任务指令。它直接告诉模型需要回答什么、执行什么操作，是对具体情景的实时输入。例如，用户可能会问“请帮我解释一下微积分的基本概念”，模型则根据之前系统提示规定的“数学老师”角色来作答。

- **动态交互**  
  User prompt 是会话中的动态部分，每次对话都会更新这一部分。模型在生成回答时，会将用户的最新输入与之前设定的系统提示一起考虑，从而既保持一致的风格，又能针对当前问题给出具体回答。

---

### 3. 处理机制上的区别

- **输入顺序和注意力分配**  
  在多轮对话中，系统提示通常被放在最前面，并作为整个上下文的一部分固定存在。由于注意力机制在处理长文本时往往会更重视位于开头和结尾的信息，系统提示因此对模型输出有更强的指导作用。而用户输入则是动态附加在后续部分的内容，虽然同样重要，但其指导作用会受到系统提示的约束。
  
- **权重和优先级**  
  模型在生成输出时会优先参考系统提示中的信息，从而确保回答符合预设的角色和风格。这意味着即使用户输入包含与预设角色不符的内容，模型也会在回答中尽量遵循系统提示设定的行为准则。
  
- **安全和防注入**  
  将关键的行为规范放在系统提示中，还可以在一定程度上防止用户通过修改输入来“注入”错误或不当指令。这样设计可以增强系统的安全性和稳定性。
  

---

### 总结

- **System Prompt**：用于全局设定模型的角色、风格和基本行为规则，具有持久性和较高权重，在整个对话过程中都发挥着指导作用。
- **User Prompt**：是用户的具体问题或指令，动态变化，根据用户需求提出任务，但在生成回答时必须在系统提示的框架内进行。

这种分层设计使得大模型既能保持一致的行为模式，又能灵活响应用户的具体需求，从而在安全性、可控性和实用性之间达到较好的平衡。

### 除了位置本身 system prompt会会有其他的特殊处理来保证权重更高吗?

是的，除了因为系统提示通常被放在对话的最前端（因此享有位置优势），系统提示在模型内部通常还会通过其他机制获得“加权”处理，从而确保它们对生成结果的影响更大。具体来说，常见的做法包括：

- **专用的标记和嵌入**  
  系统提示往往会使用专门的token或元数据来进行标记，使其在编码时与普通用户输入区分开。这种区分可以让模型在计算注意力权重时，自动给予系统提示更高的关注度。  
  
- **训练时的权重调整**  
  在预训练或微调阶段，系统提示的内容可能会被赋予更高的权重或通过特殊损失函数处理，确保模型学到这些提示对于整个对话行为的决定性作用。  

- **固定且不随对话变化**  
  系统提示通常在会话中保持不变，而用户输入会动态变化。这种不变性也使得系统提示在整个上下文中始终占据核心位置，从而在解码时更有效地“指导”生成过程。  

总的来说，这些处理方式共同作用，确保系统提示在模型内部具有更高的权重，进而在输出中持续发挥控制和约束作用。  